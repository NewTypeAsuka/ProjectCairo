<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- ê¸°ë³¸ ë©”íƒ€ -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ğŸ“NewTypeBlog:::ê¸€ì“°ê¸°ğŸ“</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap ICONS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- ê³µí†µ ì»¤ìŠ¤í…€ CSS -->
    <link rel="stylesheet" href="/src/main/resources/static/css/app.css">

    <!-- Summernote (Lite) CSS -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<a id="top"></a> <!-- ìµœìƒë‹¨ ì´ë™ ê¸°ì¤€ì  -->

<!-- ===== NAVBAR ===== -->
<nav class="navbar navbar-expand-lg bg-white border-bottom">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/src/main/resources/templates/index.html">NewTypeBlog</a>

        <!-- í–„ë²„ê±° ë²„íŠ¼ (ëª¨ë°”ì¼ ì „ìš©) -->
        <button class="navbar-toggler p-0 border-0 bg-transparent shadow-none"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarMenu"
                aria-controls="navbarMenu"
                aria-expanded="false"
                aria-label="Toggle navigation">
            <i class="bi bi-list fs-2" id="menuIcon"></i>
        </button>

        <!-- í–„ë²„ê±° ì•ˆì— ë“¤ì–´ê°ˆ ì˜ì—­ -->
        <div class="collapse navbar-collapse" id="navbarMenu">
            <ul class="navbar-nav w-100 d-flex flex-row justify-content-end gap-3 align-items-center"
                id="authArea">

                <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ -->
                <li class="nav-item">
                    <div class="form-check form-switch d-flex align-items-center gap-2 mb-0">
                        <i class="bi bi-moon"></i>
                        <input class="form-check-input"
                                type="checkbox"
                                id="darkModeToggle"
                                title="ë‹¤í¬ëª¨ë“œ ì „í™˜">
                    </div>
                </li>

                <!-- ì–¸ì–´ í† ê¸€ (ë“œë¡­ë‹¤ìš´) -->
                <li class="nav-item dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle"
                            type="button"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                            id="langToggleBtn">
                        í•œêµ­ì–´ ğŸ‡°ğŸ‡·
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><button class="dropdown-item" type="button" data-lang="ko">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</button></li>
                        <li><button class="dropdown-item" type="button" data-lang="ja">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</button></li>
                        <li><button class="dropdown-item" type="button" data-lang="en">English ğŸ‡ºğŸ‡¸</button></li>
                    </ul>
                </li>

                <!-- ë¡œê·¸ì¸ -->
                <li class="nav-item">
                    <button class="btn btn-outline-primary btn-sm w-100 text-end"
                            type="button"
                            data-bs-toggle="modal"
                            data-bs-target="#loginModal">
                        ë¡œê·¸ì¸
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- ===== CONTENT ===== -->
<main class="container py-4">

    <div class="mb-3">
        <h1 class="h4 fw-bold mb-1">ê¸€ì“°ê¸°</h1>
        <div class="text-secondary small">ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.</div>
    </div>

    <!-- ê¸€ì“°ê¸° í¼ -->
    <form id="writeForm">
        <!-- ì œëª© -->
        <div class="mb-3">
            <label for="postTitle" class="form-label">
                <h5>ì œëª©</h5>
            </label>
            <input type="text"
                    class="form-control"
                    id="postTitle"
                    name="title"
                    placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    maxlength="120"
                    required>
        </div>

        <!-- ë³¸ë¬¸(Summernote ì ìš© ëŒ€ìƒ) -->
        <div class="mb-3">
            <label for="editor" class="form-label">
                <h5>ë³¸ë¬¸</h5>
            </label>
            <textarea id="editor" name="content"></textarea>
            <div class="form-text">
                ì´ë¯¸ì§€ ì—…ë¡œë“œ/ì €ì¥ì€ ë‚˜ì¤‘ì— ì„œë²„ API ë¶™ì´ë©´ì„œ ì²˜ë¦¬í•˜ë©´ ë¼.
            </div>
        </div>

        <!-- íƒœê·¸ -->
        <div class="mb-3">

            <!-- âœ… íƒœê·¸ ì œëª© + ë±ƒì§€ (ì™¼ìª½ë¶€í„° ì—°ì† ë°°ì¹˜) -->
            <div class="d-flex align-items-center gap-2 mb-2 flex-wrap">
                <h5 class="mb-0">íƒœê·¸</h5>

                <!-- ë±ƒì§€ ì˜ì—­ -->
                <div id="tagBadgeArea" class="d-flex flex-wrap gap-1"></div>
            </div>

            <!-- ì…ë ¥ì°½ -->
            <input type="text"
                class="form-control"
                id="postTagInput"
                placeholder="#íƒœê·¸ëª… ì…ë ¥ í›„ ìŠ¤í˜ì´ìŠ¤"
                maxlength="120"
                autocomplete="off">

            <!-- ì‹¤ì œ submitì— ë„£ì„ hidden -->
            <input type="hidden" id="postTagsHidden" name="tags" value="">
        </div>

        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
        <div class="d-flex justify-content-end gap-2">
            <a class="btn btn-outline-secondary btn-sm" href="/">
                ì·¨ì†Œ
            </a>
            <button class="btn btn-primary btn-sm" type="submit">
                ì €ì¥
            </button>
        </div>
    </form>
</main>

<!-- Bootstrap JS (í•„ìˆ˜: dropdown ë“±) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- SummernoteëŠ” jQuery í•„ìš” -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

<!-- Summernote (Lite) JS -->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/lang/summernote-ko-KR.min.js"></script>

<!-- í˜ì´ì§€ ì „ìš© JS(ë‚˜ì¤‘ì— /assets/js/write.js ë¡œ ë¶„ë¦¬í•˜ë©´ ë¨) -->
<script>
    $(document).ready(function () {
        $('#editor').summernote({
            lang: 'ko-KR',
            placeholder: 'ì—¬ê¸°ì— ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”',
            height: 360,
            minHeight: 240,
            maxHeight: 700,
            focus: true,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ]
        });

        // ì¼ë‹¨ submit ë™ì‘ì€ ë§‰ê³ , ë‚˜ì¤‘ì— API ë¶™ì¼ ë•Œ ì²˜ë¦¬
        $('#writeForm').on('submit', function (e) {
            e.preventDefault();

            const title = $('#postTitle').val().trim();
            const writer = $('#postWriter').val().trim();
            const content = $('#editor').summernote('code');

            // TODO: ë‚˜ì¤‘ì— fetchë¡œ API í˜¸ì¶œí•´ì„œ ì €ì¥í•˜ë©´ ë¨
            console.log({ title, writer, content });

            alert('ì„ì‹œ: ì½˜ì†”ì— ì¶œë ¥í–ˆì–´. (ë‚˜ì¤‘ì— ì €ì¥ API ë¶™ì´ì)');
        });
    });
</script>

<!-- íƒœê·¸ ì…ë ¥/ë Œë”ë§ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
    const MAX_TAGS = 10;

    function normalizeTag(raw) {
        let t = (raw || '').trim();

        // êµ¬ë¶„ì ì œê±°(ë§ˆì§€ë§‰ì— ë¶™ëŠ” , ê³µë°± ë“±)
        t = t.replace(/[,\s]+$/g, '');

        if (!t) return '';

        // # ìë™ ë³´ì •
        if (!t.startsWith('#')) t = '#' + t;

        // íƒœê·¸ì— ê³µë°±/íŠ¹ìˆ˜êµ¬ë¶„ì ë“¤ì–´ê°€ë©´ ì •ë¦¬(ì›í•˜ë©´ ê·œì¹™ ë” ì—„ê²©í•˜ê²Œ)
        t = t.replace(/\s+/g, '');

        // ë„ˆë¬´ ì§§ìœ¼ë©´ ë¬´ì‹œ
        if (t.length < 2) return '';

        return t;
    }

    function getTags() {
        const v = $('#postTagsHidden').val().trim();
        if (!v) return [];
        try {
            return JSON.parse(v);
        } catch (e) {
            return [];
        }
    }

    function setTags(tags) {
        $('#postTagsHidden').val(JSON.stringify(tags));
    }

    function renderTags() {
        const tags = getTags();
        const $area = $('#tagBadgeArea');
        $area.empty();

        tags.forEach((tag) => {
            const $badge = $(`
                <span class="badge text-bg-light border">
                    <span class="me-1">${tag}</span>
                    <button type="button"
                            class="btn-close"
                            aria-label="Remove"
                            style="font-size: 0.65rem; vertical-align: middle;"></button>
                </span>
            `);

            $badge.find('.btn-close').on('click', function () {
                removeTag(tag);
            });

            $area.append($badge);
        });
    }

    function addTag(raw) {
        const tag = normalizeTag(raw);
        if (!tag) return;

        let tags = getTags();

        // ìµœëŒ€ ê°œìˆ˜
        if (tags.length >= MAX_TAGS) {
            alert(`íƒœê·¸ëŠ” ìµœëŒ€ ${MAX_TAGS}ê°œê¹Œì§€ ê°€ëŠ¥í•´.`);
            return;
        }

        // ì¤‘ë³µ ë°©ì§€(ëŒ€ì†Œë¬¸ì ë¬´ì‹œí•˜ë ¤ë©´ toLowerCase ë¹„êµë¡œ ë°”ê¿”ë„ ë¨)
        if (tags.includes(tag)) return;

        tags.push(tag);
        setTags(tags);
        renderTags();
    }

    function removeTag(tag) {
        let tags = getTags();
        tags = tags.filter(t => t !== tag);
        setTags(tags);
        renderTags();
    }

    $(document).ready(function () {
        // ìµœì´ˆ ë Œë”
        setTags([]);
        renderTags();

        // ìŠ¤í˜ì´ìŠ¤/ì—”í„°/ì‰¼í‘œë¡œ íƒœê·¸ í™•ì •
        $('#postTagInput').on('keydown', function (e) {
            const key = e.key;

            // í™•ì • íŠ¸ë¦¬ê±°
            if (key === ' ' || key === 'Enter' || key === ',') {
                e.preventDefault();
                const val = $(this).val();
                addTag(val);
                $(this).val('');
                return;
            }

            // ì…ë ¥ ë¹„ì—ˆê³  Backspaceë©´ ë§ˆì§€ë§‰ íƒœê·¸ ì‚­ì œ
            if (key === 'Backspace' && $(this).val().trim() === '') {
                const tags = getTags();
                if (tags.length > 0) {
                    removeTag(tags[tags.length - 1]);
                }
            }
        });

        // ë¶™ì—¬ë„£ê¸° ì§€ì›: "#a #b #c" ê°™ì€ ê±¸ ë¶™ì´ë©´ ìë™ ë¶„ë¦¬í•´ì„œ ì¶”ê°€
        $('#postTagInput').on('paste', function (e) {
            const clipboard = (e.originalEvent || e).clipboardData;
            if (!clipboard) return;

            const text = clipboard.getData('text');
            if (!text) return;

            // ë¶™ì—¬ë„£ê¸° í›„ ì²˜ë¦¬í•˜ë ¤ê³  ì‚´ì§ ì§€ì—°
            setTimeout(() => {
                const v = $('#postTagInput').val();
                // ê³µë°±/ì‰¼í‘œ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
                const parts = v.split(/[\s,]+/g).filter(Boolean);
                if (parts.length > 1) {
                    parts.forEach(p => addTag(p));
                    $('#postTagInput').val('');
                }
            }, 0);
        });

        // submit ì‹œ tags í™•ì¸(ì§€ê¸ˆì€ ì½˜ì†” ì¶œë ¥ë§Œ í•˜ëŠ” ë‹¨ê³„ë‹ˆê¹Œ)
        $('#writeForm').on('submit', function (e) {
            e.preventDefault();

            const title = $('#postTitle').val().trim();
            const content = $('#editor').summernote('code');
            const tags = getTags();

            console.log({ title, tags, content });

            alert('ì„ì‹œ: ì½˜ì†”ì— ì¶œë ¥í–ˆì–´. (ë‚˜ì¤‘ì— ì €ì¥ API ë¶™ì´ì)');
        });
    });
</script>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ê³µí†µ JS -->
<script src="/src/main/resources/static/js/app.js"></script>
<script src="/src/main/resources/static/js/navbar.js"></script>
</body>
</html>
