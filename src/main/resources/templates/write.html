<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- ê¸°ë³¸ ë©”íƒ€ -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>ğŸ“NewTypeBlog:::ê¸€ì“°ê¸°ğŸ“</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap ICONS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- ê³µí†µ ì»¤ìŠ¤í…€ CSS -->
    <link rel="stylesheet" href="/src/main/resources/static/css/app.css">

    <!-- Summernote (Lite) CSS -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<a id="top"></a> <!-- ìµœìƒë‹¨ ì´ë™ ê¸°ì¤€ì  -->

<!-- ===== NAVBAR ===== -->
<nav class="navbar navbar-expand-lg bg-white border-bottom">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/src/main/resources/templates/index.html">NewTypeBlog</a>

        <!-- í–„ë²„ê±° ë²„íŠ¼ (ëª¨ë°”ì¼ ì „ìš©) -->
        <button class="navbar-toggler p-0 border-0 bg-transparent shadow-none"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarMenu"
                aria-controls="navbarMenu"
                aria-expanded="false"
                aria-label="Toggle navigation">
            <i class="bi bi-list fs-2" id="menuIcon"></i>
        </button>

        <!-- í–„ë²„ê±° ì•ˆì— ë“¤ì–´ê°ˆ ì˜ì—­ -->
        <div class="collapse navbar-collapse" id="navbarMenu">
            <ul class="navbar-nav w-100 d-flex flex-row justify-content-end gap-3 align-items-center"
                id="authArea">

                <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ -->
                <li class="nav-item">
                    <div class="form-check form-switch d-flex align-items-center gap-2 mb-0">
                        <i class="bi bi-moon"></i>
                        <input class="form-check-input"
                                type="checkbox"
                                id="darkModeToggle"
                                title="ë‹¤í¬ëª¨ë“œ ì „í™˜">
                    </div>
                </li>

                <!-- ì–¸ì–´ í† ê¸€ (ë“œë¡­ë‹¤ìš´) -->
                <li class="nav-item dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle"
                            type="button"
                            data-bs-toggle="dropdown"
                            aria-expanded="false"
                            id="langToggleBtn">
                        í•œêµ­ì–´ ğŸ‡°ğŸ‡·
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><button class="dropdown-item" type="button" data-lang="ko">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</button></li>
                        <li><button class="dropdown-item" type="button" data-lang="ja">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</button></li>
                        <li><button class="dropdown-item" type="button" data-lang="en">English ğŸ‡ºğŸ‡¸</button></li>
                    </ul>
                </li>

                <!-- ë¡œê·¸ì¸ -->
                <li class="nav-item">
                    <button class="btn btn-outline-primary btn-sm w-100 text-end"
                            type="button"
                            data-bs-toggle="modal"
                            data-bs-target="#loginModal">
                        ë¡œê·¸ì¸
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- ===== CONTENT ===== -->
<main class="container py-4">

    <div class="mb-3">
        <h1 class="h4 fw-bold mb-1">ê¸€ì“°ê¸°</h1>
        <div class="text-secondary small">ìƒˆ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”.</div>
    </div>

    <!-- ê¸€ì“°ê¸° í¼ -->
    <form id="writeForm">
        <!-- ì œëª© -->
        <div class="mb-3">
            <label for="postTitle" class="form-label">
                <h5>ì œëª©</h5>
            </label>
            <input type="text"
                    class="form-control"
                    id="postTitle"
                    name="title"
                    placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                    maxlength="120"
                    required>
        </div>

        <!-- ë³¸ë¬¸(Summernote ì ìš© ëŒ€ìƒ) -->
        <div class="mb-3">
            <label for="editor" class="form-label">
                <h5>ë³¸ë¬¸</h5>
            </label>
            <textarea id="editor" name="content"></textarea>
            <div class="form-text">
                ì´ë¯¸ì§€ ì—…ë¡œë“œ/ì €ì¥ì€ ë‚˜ì¤‘ì— ì„œë²„ API ë¶™ì´ë©´ì„œ ì²˜ë¦¬í•˜ë©´ ë¼.
            </div>
        </div>

        <!-- íƒœê·¸ -->
        <div class="mb-3">
            <label for="postTags" class="form-label">
                <h5 class="mb-1">íƒœê·¸</h5>
            </label>

            <input type="text"
                class="form-control"
                id="postTags"
                name="tagsInput"
                placeholder="#íƒœê·¸ëª… ì…ë ¥ í›„ ìŠ¤í˜ì´ìŠ¤ë°” ë˜ëŠ” ì—”í„°"
                maxlength="120"
                autocomplete="off">

            <!-- âœ… íƒœê·¸ ê³ ì • ì˜ì—­ -->
            <div id="tagBadgeWrapper" class="mt-2">
                <div id="tagBadgeArea"></div>
                <div id="tagHint" class="small text-muted mt-1">
                    ìµœëŒ€ 2ê°œê¹Œì§€ ì…ë ¥ ê°€ëŠ¥ (#íƒœê·¸ëª… í›„ ìŠ¤í˜ì´ìŠ¤/ì—”í„°)
                </div>
            </div>

            <input type="hidden" id="postTagsHidden" name="tags" value="">
        </div>


        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
        <div class="d-flex justify-content-end gap-2">
            <a class="btn btn-outline-secondary btn-sm" href="/">
                ì·¨ì†Œ
            </a>
            <button class="btn btn-primary btn-sm" type="submit">
                ì €ì¥
            </button>
        </div>
    </form>
</main>

<!-- Bootstrap JS (í•„ìˆ˜: dropdown ë“±) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- SummernoteëŠ” jQuery í•„ìš” -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>

<!-- Summernote (Lite) JS -->
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/lang/summernote-ko-KR.min.js"></script>

<!-- í˜ì´ì§€ ì „ìš© JS(ë‚˜ì¤‘ì— /assets/js/write.js ë¡œ ë¶„ë¦¬í•˜ë©´ ë¨) -->
<script>
    $(document).ready(function () {
        $('#editor').summernote({
            lang: 'ko-KR',
            placeholder: 'ì—¬ê¸°ì— ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”',
            height: 360,
            minHeight: 240,
            maxHeight: 700,
            focus: true,
            toolbar: [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'clear']],
                ['fontname', ['fontname']],
                ['fontsize', ['fontsize']],
                ['color', ['color']],
                ['para', ['ul', 'ol', 'paragraph']],
                ['table', ['table']],
                ['insert', ['link', 'picture', 'video']],
                ['view', ['fullscreen', 'codeview', 'help']]
            ]
        });

        // ì¼ë‹¨ submit ë™ì‘ì€ ë§‰ê³ , ë‚˜ì¤‘ì— API ë¶™ì¼ ë•Œ ì²˜ë¦¬
        $('#writeForm').on('submit', function (e) {
            e.preventDefault();

            const title = $('#postTitle').val().trim();
            const writer = $('#postWriter').val().trim();
            const content = $('#editor').summernote('code');

            // TODO: ë‚˜ì¤‘ì— fetchë¡œ API í˜¸ì¶œí•´ì„œ ì €ì¥í•˜ë©´ ë¨
            console.log({ title, writer, content });

            alert('ì„ì‹œ: ì½˜ì†”ì— ì¶œë ¥í–ˆì–´. (ë‚˜ì¤‘ì— ì €ì¥ API ë¶™ì´ì)');
        });
    });
</script>

<!-- íƒœê·¸ ê´€ë ¨ -->
 <script>
    // ===== TAG UI (gray fixed area) =====
    (function () {
        const tagInput = document.getElementById('postTags');
        const badgeArea = document.getElementById('tagBadgeArea');
        const hiddenInput = document.getElementById('postTagsHidden');

        if (!tagInput || !badgeArea || !hiddenInput) return;

        const MAX_TAGS = 2;
        let tags = [];

        // íšŒìƒ‰ ì˜ì—­ ë‚´ë¶€ì— "ì•ˆë‚´ë¬¸êµ¬" + "ë±ƒì§€ ì»¨í…Œì´ë„ˆ"ë¥¼ ê³ ì • ìƒì„±
        badgeArea.classList.add('tag-area'); // (ì›í•˜ë©´ CSSì—ì„œ ì‚¬ìš©)
        badgeArea.innerHTML = `
            <div id="tagHint" class="tag-hint">ìµœëŒ€ 2ê°œê¹Œì§€ ì…ë ¥ ê°€ëŠ¥ (#íƒœê·¸ëª… í›„ ìŠ¤í˜ì´ìŠ¤/ì—”í„°)</div>
            <div id="tagBadgeRow" class="tag-badge-row"></div>
        `;

        const hintEl = badgeArea.querySelector('#tagHint');
        const rowEl = badgeArea.querySelector('#tagBadgeRow');

        function setHint(msg, isError) {
            hintEl.textContent = msg;
            hintEl.classList.toggle('text-danger', !!isError);
        }

        function normalizeTag(raw) {
            if (!raw) return '';
            let t = raw.trim();

            // ì•ì˜ # ì œê±°
            t = t.replace(/^#+/, '').trim();

            // ê³µë°±/êµ¬ë¶„ì ì œê±°(ê¸°ë³¸), í—ˆìš©ë¬¸ìë§Œ ë‚¨ê¹€: í•œê¸€/ì˜ë¬¸/ìˆ«ì/_/-
            t = t.replace(/[^\p{Script=Hangul}A-Za-z0-9_-]/gu, '');

            return t;
        }

        function syncHidden() {
            hiddenInput.value = tags.join(',');
        }

        function render() {
            rowEl.innerHTML = '';

            tags.forEach((t) => {
                const badge = document.createElement('span');
                badge.className = 'badge text-bg-light border tag-badge';
                badge.setAttribute('data-tag', t);

                // âœ… ê¸´ íƒœê·¸ì—¬ë„ X ë²„íŠ¼ì´ í•­ìƒ ë³´ì´ë„ë¡: í…ìŠ¤íŠ¸/ë²„íŠ¼ì„ ë¶„ë¦¬
                badge.innerHTML = `
                    <span class="tag-text">#${t}</span>
                    <button type="button" class="btn-close btn-close-sm tag-remove" aria-label="Remove"></button>
                `;

                badge.querySelector('.tag-remove').addEventListener('click', () => {
                    tags = tags.filter(x => x !== t);
                    render();
                    setHint('ìµœëŒ€ 2ê°œê¹Œì§€ ì…ë ¥ ê°€ëŠ¥ (#íƒœê·¸ëª… í›„ ìŠ¤í˜ì´ìŠ¤/ì—”í„°)', false);
                });

                rowEl.appendChild(badge);
            });

            syncHidden();
        }

        function tryAddTag(raw) {
            const t = normalizeTag(raw);
            if (!t) return;

            if (tags.includes(t)) {
                setHint('ì´ë¯¸ ì¶”ê°€ëœ íƒœê·¸ì•¼.', true);
                return;
            }
            if (tags.length >= MAX_TAGS) {
                setHint('íƒœê·¸ëŠ” ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ê°€ëŠ¥í•´.', true);
                return;
            }

            tags.push(t);
            render();
            setHint('ìµœëŒ€ 2ê°œê¹Œì§€ ì…ë ¥ ê°€ëŠ¥ (#íƒœê·¸ëª… í›„ ìŠ¤í˜ì´ìŠ¤/ì—”í„°)', false);
        }

        // ìŠ¤í˜ì´ìŠ¤/ì—”í„°ë¡œ íƒœê·¸ í™•ì •
        tagInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                tryAddTag(tagInput.value);
                tagInput.value = '';
                return;
            }

            // ì…ë ¥ì´ ë¹„ì–´ìˆì„ ë•Œ ë°±ìŠ¤í˜ì´ìŠ¤ => ë§ˆì§€ë§‰ íƒœê·¸ ì‚­ì œ(í¸ì˜)
            if (e.key === 'Backspace' && tagInput.value === '' && tags.length > 0) {
                tags.pop();
                render();
            }
        });

        // ë¶™ì—¬ë„£ê¸°: "#a #b" / "#a,#b" ê°™ì€ ì…ë ¥ ì²˜ë¦¬
        tagInput.addEventListener('paste', (e) => {
            const text = (e.clipboardData || window.clipboardData).getData('text') || '';
            const parts = text.split(/[\s,]+/).filter(Boolean);
            if (parts.length <= 1) return;

            e.preventDefault();
            parts.forEach(p => tryAddTag(p));
            tagInput.value = '';
        });

        render();
    })();
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ê³µí†µ JS -->
<script src="/src/main/resources/static/js/app.js"></script>
<script src="/src/main/resources/static/js/navbar.js"></script>
</body>
</html>
